<div class="page-header">
  <h1>
    My Invoices
    <a href="/invoices/new" class="btn btn-lg btn-warning">[Testing Only] New Invoice</a>
  </h1>
</div>
<div class="row">
  <!-- <div class="col-md-2 card">
    <h4>Invoices</h4>
    <br>
    <a href="/invoices/balance_due">Balance Due</a>
    <hr>
    <a href="/invoices">All</a>
    <hr>
  </div> -->

  <div class="col-md-12">
    <table class="table table-striped table-hover">
      <tr>
        <th>Date</th>
        <th>Unit</th>
        <th>Status</th>
        <th>Remaining Balance</th>
        <th>Assessment Type</th>
        <th>Actions</th>
      </tr>

      <% @invoices.each do |invoice| %>
      <tr>
        <% @paidamt = 0 %>
        <% invoice.payments.each do |payment| %>
        <% @paidamt += payment.amount %>
        <% end %>
        <!-- <% if @paidamt >= invoice.amount %>
          <% invoice.status = "Paid in Full" %>
          <% invoice.save %>
        <% elsif @paidamt > 0 %>
          <% invoice.status = "Partially Paid" %>
          <% invoice.save %>
        <% end %> -->
        <td>
          <%= Date::MONTHNAMES[invoice.created_at.month] %> <%= invoice.created_at.year %>
        </td>
        <td>
          <% if invoice.unit.present? %>
          <%= invoice.unit.unit_number %>
          <% end %>
        </td>
        <td><%= invoice.status %></td>
        <td>
          <% if invoice.payments != nil %>
            $ <%= invoice.amount - @paidamt %>
          <% else %>
            $ <%= invoice.amount %>
          <% end %>
        </td>
        <td><%= invoice.assessment_type %></td>
        <td>
          <a href="/invoices/<%= invoice.id %>" class="btn btn-primary">Show</a>
        </td>
      </tr>
      <% end %>
    </table>
    <%= paginate @invoices, theme: 'twitter-bootstrap-4' %>
  </div>
</div>
